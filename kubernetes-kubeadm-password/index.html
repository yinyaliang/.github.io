<!doctype html>
<html lang="zh" class="no-js">
  <head>
     <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3436206915764997"
     crossorigin="anonymous"></script>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>密码管理 - 尹亚亮</title>
<meta name="description" content="密码管理的几种方式">


  <meta name="author" content="Your Name">
  
  <meta property="article:author" content="Your Name">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="zh_CN">
<meta property="og:site_name" content="尹亚亮">
<meta property="og:title" content="密码管理">
<meta property="og:url" content="/kubernetes-kubeadm-password/">


  <meta property="og:description" content="密码管理的几种方式">







  <meta property="article:published_time" content="2022-09-27T00:00:00+08:00">





  

  


<link rel="canonical" href="/kubernetes-kubeadm-password/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Your Name",
      "url": "/"
    
  }
</script>


  <meta name="google-site-verification" content="A4xb7189wuH7_ck4RBWFMcZetHQvGEtM6c4NkowkBXo" />




  <meta name="yandex-verification" content="b34490b8136e1c97">


  <meta name="naver-site-verification" content="bcc3391cbb77775a98167dd719a9653fad02042a">


  <meta name="baidu-site-verification" content="code-faatzlDIxD">

<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="尹亚亮 Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    
  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">转到主导航栏</a></li>
    <li><a href="#main" class="screen-reader-shortcut">转到内容</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">转到底部</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          尹亚亮
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/year-archive/">归档</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/">分类</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">切换菜单</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
  </div>



  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="密码管理">
    <meta itemprop="description" content="密码管理的几种方式">
    <meta itemprop="datePublished" content="2022-09-27T00:00:00+08:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="/kubernetes-kubeadm-password/" class="u-url" itemprop="url">密码管理
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2022-09-27T00:00:00+08:00">September 27, 2022</time>
      </span>
    

    

    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> 目录</h4></header>
              <ul class="toc__menu"><li><a href="#创建及删除secret">创建及删除secret</a><ul><li><a href="#创建secret">创建secret</a></li><li><a href="#命令行">命令行</a></li><li><a href="#把文件创建为secret">把文件创建为secret</a></li><li><a href="#变量文件的方法">变量文件的方法</a></li><li><a href="#通过yaml文件的方式">通过yaml文件的方式</a></li><li><a href="#删除secret">删除secret</a></li></ul></li></ul></li><li><a href="#在pod里以变量和卷的方式引用secret">在pod里以变量和卷的方式引用secret</a><ul><li><a href="#以卷的方式">以卷的方式</a></li><li><a href="#以变量的方式">以变量的方式</a></li></ul></li></ul></li><li><a href="#创建及删除configmap">创建及删除configmap</a><ul><li><a href="#命令行的方式">命令行的方式</a></li><li><a href="#文件方式">文件方式</a></li><li><a href="#使用configmap">使用configmap</a></li><li><a href="#以变量的方式-1">以变量的方式</a></li></ul></li></ul></li></ul>

            </nav>
          </aside>
        
        <p>密码管理的几种方式</p>

<h2 id="创建及删除secret">创建及删除secret</h2>

<p>避免mysql类型的容器变量保存在yaml里不安全,可以使用secret,保存方式为</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>键=值 或者是 key=value
</code></pre></div></div>

<h4 id="创建secret">创建secret</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master ~]# <span class="nb">mkdir </span>secret
<span class="o">[</span>root@master ~]# <span class="nb">cd </span>secret/
</code></pre></div></div>

<p>创建一个新的命名空间</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master secret]# kubectl create ns nssec
namespace/nssec created
<span class="o">[</span>root@master secret]# kubens nssec
Context <span class="s2">"kubernetes-admin@kubernetes"</span> modified.
Active namespace is <span class="s2">"nssec"</span><span class="nb">.</span>
</code></pre></div></div>

<h4 id="命令行">命令行</h4>

<p>kubectl create secret generic 名字 –from-literal=k1=v1 –from-literal=k2=v2</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 创建一个名字为 mysecret1 的 secret</span>
<span class="o">[</span>root@master secret]# kubectl create secret generic mysecret1 <span class="nt">--from-literal</span><span class="o">=</span><span class="nv">xx</span><span class="o">=</span>tom <span class="nt">--from-literal</span><span class="o">=</span><span class="nv">yy</span><span class="o">=</span>redhat
secret/mysecret1 created
</code></pre></div></div>

<p>查看</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master secret]# kubectl get secrets
NAME                  TYPE                                  DATA   AGE
default-token-twgk8   kubernetes.io/service-account-token   3      2m56s
mysecret1             Opaque                                2      20s
</code></pre></div></div>

<p>secret有三种类型</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1、 Opaque: base64编码格式的secret，用来存储密码、密钥,数据可以通过base64解码
2、 kubernetes.io/dockerconfigjson: 用来存储私有docker registry的认证信息
3、 kubernetes.io/sevice-account-token: 用来被serviceaccount引用
</code></pre></div></div>

<p>创建serviceaccount时, kubernets会默认创建对应的secret.pod如果使用了serviceaccout,对应的secret会自动挂在到Pod目录/run/secrets/kubernets.io/serviceaccount</p>

<p>查看mysecret1的具体属性</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master secret]# kubectl describe secrets mysecret1
Name:         mysecret1
Namespace:    nssec
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;

Type:  Opaque

Data
<span class="o">====</span>
xx:  3 bytes
yy:  6 bytes
</code></pre></div></div>

<p>这里可以看到两个变量,分别是xx和yy,但具体是什么这里看不出来</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master secret]# kubectl describe secrets mysecret1
Name:         mysecret1
Namespace:    nssec
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;

Type:  Opaque

Data
<span class="o">====</span>
xx:  3 bytes
yy:  6 bytes
<span class="o">[</span>root@master secret]# kubectl get secret mysecret1 <span class="nt">-o</span> yaml
apiVersion: v1
data:
  xx: dG9t
  yy: cmVkaGF0
kind: Secret
metadata:
  creationTimestamp: <span class="s2">"2022-07-19T15:38:45Z"</span>
  name: mysecret1
  namespace: nssec
  resourceVersion: <span class="s2">"98855"</span>
  uid: 388779de-d3aa-4a9e-bfbf-7f7d63b1af9a
<span class="nb">type</span>: Opaque
</code></pre></div></div>

<p>上面data字段里就是mysecret1的键值对,需要base64解码才可以看到具体值</p>

<p>解码</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master secret]# <span class="nb">echo</span> <span class="s2">"dG9t"</span> | <span class="nb">base64</span> <span class="nt">--decode</span>
tom[root@master secret]#  <span class="nb">echo</span> <span class="s2">"cmVkaGF0"</span> | <span class="nb">base64</span> <span class="nt">--decode</span>
redhat[root@master secret]# 
</code></pre></div></div>

<h4 id="把文件创建为secret">把文件创建为secret</h4>

<p>文件名作为key，内容作为value.</p>

<p>kubectl create secret generic mysecret2 –from-file=file1 –from-file=file2</p>

<p>作用是把一个文件的内容写入secret里,通过卷的方式来引用这个secret,就可以把此文件写入pod里了</p>

<p>查看hosts</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master secret]# <span class="nb">cat</span> /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
192.168.122.200 master
192.168.122.202 node1 
192.168.122.203 node2 
</code></pre></div></div>

<p>创建secret</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master secret]# kubectl create secret generic mysecret2 <span class="nt">--from-file</span><span class="o">=</span>/etc/hosts
secret/mysecret2 created
</code></pre></div></div>

<p>查看</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master secret]# kubectl get secrets mysecret2 <span class="nt">-o</span> yaml
apiVersion: v1
data:
  hosts: <span class="nv">MTI3LjAuMC4xICAgbG9jYWxob3N0IGxvY2FsaG9zdC5sb2NhbGRvbWFpbiBsb2NhbGhvc3Q0IGxvY2FsaG9zdDQubG9jYWxkb21haW40Cjo6MSAgICAgICAgIGxvY2FsaG9zdCBsb2NhbGhvc3QubG9jYWxkb21haW4gbG9jYWxob3N0NiBsb2NhbGhvc3Q2LmxvY2FsZG9tYWluNgoxOTIuMTY4LjEyMi4yMDAgbWFzdGVyCjE5Mi4xNjguMTIyLjIwMiBub2RlMSAKMTkyLjE2OC4xMjIuMjAzIG5vZGUyIAo</span><span class="o">=</span>
kind: Secret
metadata:
  creationTimestamp: <span class="s2">"2022-07-19T15:49:12Z"</span>
  name: mysecret2
  namespace: nssec
  resourceVersion: <span class="s2">"99732"</span>
  uid: 1e095123-849f-4cde-b092-ac574252075c
<span class="nb">type</span>: Opaque
</code></pre></div></div>

<p>hosts代表文件，下面是内容</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master secret]# kubectl get secrets mysecret2 <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.data.hosts}'</span>
<span class="nv">MTI3LjAuMC4xICAgbG9jYWxob3N0IGxvY2FsaG9zdC5sb2NhbGRvbWFpbiBsb2NhbGhvc3Q0IGxvY2FsaG9zdDQubG9jYWxkb21haW40Cjo6MSAgICAgICAgIGxvY2FsaG9zdCBsb2NhbGhvc3QubG9jYWxkb21haW4gbG9jYWxob3N0NiBsb2NhbGhvc3Q2LmxvY2FsZG9tYWluNgoxOTIuMTY4LjEyMi4yMDAgbWFzdGVyCjE5Mi4xNjguMTIyLjIwMiBub2RlMSAKMTkyLjE2OC4xMjIuMjAzIG5vZGUyIAo</span><span class="o">=</span>
</code></pre></div></div>

<p>解码</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master secret]# kubectl get secrets mysecret2 <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.data.hosts}'</span> | <span class="nb">base64</span> <span class="nt">-d</span>
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
192.168.122.200 master
192.168.122.202 node1 
192.168.122.203 node2 
</code></pre></div></div>

<p>创建一个包含两个文件的secret mysecret3</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master secret]# kubectl create secret generic mysecret3 <span class="nt">--from-file</span><span class="o">=</span>/etc/hosts <span class="nt">--from-file</span><span class="o">=</span>/etc/issue
secret/mysecret3 created
</code></pre></div></div>

<p>获取mysecret3的键值对</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master secret]# kubectl get secrets mysecret3 <span class="nt">-o</span> yaml
apiVersion: v1
data:
  hosts: <span class="nv">MTI3LjAuMC4xICAgbG9jYWxob3N0IGxvY2FsaG9zdC5sb2NhbGRvbWFpbiBsb2NhbGhvc3Q0IGxvY2FsaG9zdDQubG9jYWxkb21haW40Cjo6MSAgICAgICAgIGxvY2FsaG9zdCBsb2NhbGhvc3QubG9jYWxkb21haW4gbG9jYWxob3N0NiBsb2NhbGhvc3Q2LmxvY2FsZG9tYWluNgoxOTIuMTY4LjEyMi4yMDAgbWFzdGVyCjE5Mi4xNjguMTIyLjIwMiBub2RlMSAKMTkyLjE2OC4xMjIuMjAzIG5vZGUyIAo</span><span class="o">=</span>
  issue: <span class="nv">XFMKS2VybmVsIFxyIG9uIGFuIFxtCgo</span><span class="o">=</span>
kind: Secret
metadata:
  creationTimestamp: <span class="s2">"2022-07-19T15:51:57Z"</span>
  name: mysecret3
  namespace: nssec
  resourceVersion: <span class="s2">"99966"</span>
  uid: f68c6996-7f6a-476f-b81c-85770498cda2
<span class="nb">type</span>: Opaque
</code></pre></div></div>

<p>这种方法一般用于给pod传递文件</p>

<h4 id="变量文件的方法">变量文件的方法</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>变量 1 = 值 1
变量 2 = 值 2
</code></pre></div></div>

<p>创建变量文件env.txt</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master secret]# <span class="nb">cat </span>env.txt 
<span class="nv">xx</span><span class="o">=</span>tom
<span class="nv">yy</span><span class="o">=</span>redhat
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master secret]# kubectl create secret generic mysecret4 <span class="nt">--from-env-file</span><span class="o">=</span>env.txt
secret/mysecret4 created
</code></pre></div></div>

<h4 id="通过yaml文件的方式">通过yaml文件的方式</h4>

<p>先求出base64的值</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master secret]# <span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"tom"</span> | <span class="nb">base64
</span>dG9t
<span class="o">[</span>root@master secret]# <span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"redhat"</span> | <span class="nb">base64
</span>cmVkaGF0
</code></pre></div></div>

<p>创建yaml文件</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span>  <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span>  <span class="s">Secret</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span>  <span class="s">mysecret5</span>
<span class="na">type</span><span class="pi">:</span>  <span class="s">Opaque</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">xx</span><span class="pi">:</span>  <span class="s">dG9t</span>
  <span class="na">redhat</span><span class="pi">:</span>  <span class="s">cmVkaGF0</span>
</code></pre></div></div>

<p>创建secret</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master secret]# kubectl apply <span class="nt">-f</span> secret5.yaml 
secret/mysecret5 created
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master secret]# kubectl get secrets
NAME                  TYPE                                  DATA   AGE
default-token-twgk8   kubernetes.io/service-account-token   3      24m
mysecret1             Opaque                                2      21m
mysecret2             Opaque                                1      11m
mysecret3             Opaque                                2      8m19s
mysecret4             Opaque                                2      3m26s
mysecret5             Opaque                                2      20s
</code></pre></div></div>

<h4 id="删除secret">删除secret</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master secret]# kubectl delete secrets mysecret5
secret <span class="s2">"mysecret5"</span> deleted
</code></pre></div></div>

<h2 id="在pod里以变量和卷的方式引用secret">在pod里以变量和卷的方式引用secret</h2>

<h4 id="以卷的方式">以卷的方式</h4>

<p>在pod的yaml文件里,创建一个类型为secret的卷，然后挂在到容器里某个制定的目录里。容器创建好后,会在容器的挂在目录里创建一个文件，此文件的文件名为secret里的key.文件内容对应key的value.以卷的方式引用secret的主要作用是往pod里传递文件</p>

<p>创建pod的yaml文件</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span>  <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span>  <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">creationTimestamp</span><span class="pi">:</span>  <span class="no">null</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">run</span><span class="pi">:</span>  <span class="s">pod1</span>
  <span class="na">name</span><span class="pi">:</span>  <span class="s">pod1</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span>  <span class="s">xx</span>
    <span class="na">secret</span><span class="pi">:</span>
      <span class="na">secretName</span><span class="pi">:</span>  <span class="s">mysecret2</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span>  <span class="s">nginx</span>
    <span class="na">imagePullPolicy</span><span class="pi">:</span>  <span class="s">IfNotPresent</span>
    <span class="na">name</span><span class="pi">:</span>  <span class="s">pod1</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span>  <span class="s">xx</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/etc/test"</span>
<span class="na">status</span><span class="pi">:</span>  <span class="pi">{}</span>
</code></pre></div></div>

<p>在pod1里吧xx这个卷挂在到/etc/test/目录里.容器里会有hosts文件</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master secret]# kubectl apply <span class="nt">-f</span> pod1.yaml 
pod/pod1 created
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master secret]# kubectl <span class="nb">exec </span>pod1 <span class="nt">--</span> <span class="nb">cat</span> /etc/test/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
192.168.122.200 master
192.168.122.202 node1 
192.168.122.203 node2 
</code></pre></div></div>

<p>删除pod</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl delete <span class="nt">-f</span> pod1.yaml
</code></pre></div></div>

<p>修改pod1.yaml</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span>  <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span>  <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">creationTimestamp</span><span class="pi">:</span>  <span class="no">null</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">run</span><span class="pi">:</span>  <span class="s">pod1</span>
  <span class="na">name</span><span class="pi">:</span>  <span class="s">pod1</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span>  <span class="s">xx</span>
    <span class="na">secret</span><span class="pi">:</span>
      <span class="na">secretName</span><span class="pi">:</span>  <span class="s">mysecret3</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span>  <span class="s">nginx</span>
    <span class="na">imagePullPolicy</span><span class="pi">:</span>  <span class="s">IfNotPresent</span>
    <span class="na">name</span><span class="pi">:</span>  <span class="s">pod1</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span>  <span class="s">xx</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/etc/test/issue"</span>
      <span class="na">subPath</span><span class="pi">:</span>  <span class="s">issue</span>
<span class="na">status</span><span class="pi">:</span>  <span class="pi">{}</span>
</code></pre></div></div>

<p>mysecret3里有两个文件，如果只想使用一个,可以使用subPath来解决</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master secret]# kubectl apply <span class="nt">-f</span> pod1.yaml 
pod/pod1 created
<span class="o">[</span>root@master secret]# kubectl <span class="nb">exec </span>pod1 <span class="nt">--</span> <span class="nb">ls</span> /etc/test/
issue
</code></pre></div></div>

<p>如果修改服务的配置文件,比如nginx的配置文件,可以不需要重新编译镜像</p>

<h4 id="以变量的方式">以变量的方式</h4>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">env</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span>  <span class="s">变量名</span>
  <span class="na">value</span><span class="pi">:</span>  <span class="s">值</span>
</code></pre></div></div>

<p>如果是从secret引用值,这里写valueFrom</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">env</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span>  <span class="s">变量名</span>
  <span class="na">valueFrom</span><span class="pi">:</span>
    <span class="na">secretKeyRef</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span>  <span class="s">secretX</span>
      <span class="na">key</span><span class="pi">:</span>  <span class="s">keyX</span>
</code></pre></div></div>

<p>变量的值会使用secretX里的keyX这个键对应的值</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span>  <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span>  <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">creationTimestamp</span><span class="pi">:</span>  <span class="no">null</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">run</span><span class="pi">:</span>  <span class="s">pod2</span>
  <span class="na">name</span><span class="pi">:</span>  <span class="s">pod2</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span>  <span class="s">mysql</span>
    <span class="na">imagePullPolicy</span><span class="pi">:</span>  <span class="s">IfNotPresent</span>
    <span class="na">name</span><span class="pi">:</span>  <span class="s">pod2</span>
    <span class="na">env</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span>  <span class="s">MYSQL_ROOT_PASSWORD</span>
      <span class="na">valueFrom</span><span class="pi">:</span> 
        <span class="na">secretKeyRef</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span>  <span class="s">mysecret1</span>
          <span class="na">key</span><span class="pi">:</span>  <span class="s">yy</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master secret]# kubectl apply <span class="nt">-f</span> pod2.yaml
pod/pod2 created
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master secret]# kubectl get pods <span class="nt">-o</span> wide
NAME   READY   STATUS    RESTARTS   AGE   IP              NODE    NOMINATED NODE   READINESS GATES
pod1   1/1     Running   0          11m   10.244.104.22   node2   &lt;none&gt;           &lt;none&gt;
pod2   1/1     Running   0          16s   10.244.104.23   node2   &lt;none&gt;           &lt;none&gt;
</code></pre></div></div>

<h2 id="创建及删除configmap">创建及删除configmap</h2>

<p>主要作用:</p>

<ul>
  <li>存储密码</li>
  <li>往pod里传递文件</li>
  <li>格式: 键=值</li>
</ul>

<p>和secret的区别:</p>

<ul>
  <li>不使用base64编码</li>
</ul>

<p>查看命令</p>

<p>kubectl get configmaps</p>

<p>创建方法</p>

<ul>
  <li>直接指定key和value</li>
  <li>把一个文件内容作为value</li>
  <li>直接写yaml</li>
</ul>

<h4 id="命令行的方式">命令行的方式</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl create cm 名字 <span class="nt">--from-literal</span><span class="o">=</span><span class="nv">key</span><span class="o">=</span>v1 <span class="nt">--from-literal</span><span class="o">=</span><span class="nv">k2</span><span class="o">=</span>v2 ...
</code></pre></div></div>

<p>创建一个my1的configmap</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master ~]# kubectl create configmap my1 <span class="nt">--from-literal</span><span class="o">=</span><span class="nv">xx</span><span class="o">=</span>tom <span class="nt">--from-literal</span><span class="o">=</span><span class="nv">yy</span><span class="o">=</span>redhat
configmap/my1 created
</code></pre></div></div>

<p>查看</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master ~]# kubectl get configmaps
NAME               DATA   AGE
kube-root-ca.crt   1      47h
my1                2      26s
<span class="o">[</span>root@master ~]# kubectl describe configmaps my1
Name:         my1
Namespace:    nssec
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;

Data
<span class="o">====</span>
xx:
<span class="nt">----</span>
tom
yy:
<span class="nt">----</span>
redhat
Events:  &lt;none&gt;
</code></pre></div></div>

<h4 id="文件方式">文件方式</h4>

<p>kubectl create configmap my2 –from-file=file1</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl create configmap my2 <span class="nt">--from-file</span><span class="o">=</span>/etc/hosts <span class="nt">--from-file</span><span class="o">=</span>/etc/issue
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master ~]# kubectl create configmap my2 <span class="nt">--from-file</span><span class="o">=</span>/etc/hosts <span class="nt">--from-file</span><span class="o">=</span>/etc/issue
configmap/my2 created
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master ~]# kubectl create configmap my2 <span class="nt">--from-file</span><span class="o">=</span>/etc/hosts <span class="nt">--from-file</span><span class="o">=</span>/etc/issue
configmap/my2 created
<span class="o">[</span>root@master ~]# 
<span class="o">[</span>root@master ~]# kubectl get cm
NAME               DATA   AGE
kube-root-ca.crt   1      47h
my1                2      2m37s
my2                2      16s
<span class="o">[</span>root@master ~]# kubectl describe cm my2
Name:         my2
Namespace:    nssec
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;

Data
<span class="o">====</span>
hosts:
<span class="nt">----</span>
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
192.168.122.200 master
192.168.122.202 node1 
192.168.122.203 node2 

issue:
<span class="nt">----</span>
<span class="se">\S</span>
Kernel <span class="se">\r</span> on an <span class="se">\m</span>


Events:  &lt;none&gt;
</code></pre></div></div>

<p>或者</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master ~]# kubectl describe cm my2
Name:         my2
Namespace:    nssec
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;

Data
<span class="o">====</span>
hosts:
<span class="nt">----</span>
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
192.168.122.200 master
192.168.122.202 node1 
192.168.122.203 node2 

issue:
<span class="nt">----</span>
<span class="se">\S</span>
Kernel <span class="se">\r</span> on an <span class="se">\m</span>


Events:  &lt;none&gt;
<span class="o">[</span>root@master ~]# kubectl get cm my2 <span class="nt">-o</span> yaml
apiVersion: v1
data:
  hosts: <span class="s2">"127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><span class="se">\n</span><span class="s2">::1
    </span><span class="se">\ </span><span class="s2">       localhost localhost.localdomain localhost6 localhost6.localdomain6</span><span class="se">\n</span><span class="s2">192.168.122.200
    master</span><span class="se">\n</span><span class="s2">192.168.122.202 node1 </span><span class="se">\n</span><span class="s2">192.168.122.203 node2 </span><span class="se">\n</span><span class="s2">"</span>
  issue: |+
    <span class="se">\S</span>
    Kernel <span class="se">\r</span> on an <span class="se">\m</span>

kind: ConfigMap
metadata:
  creationTimestamp: <span class="s2">"2022-07-21T15:06:23Z"</span>
  name: my2
  namespace: nssec
  resourceVersion: <span class="s2">"106264"</span>
  uid: 68f8f1b3-f44e-4303-91c9-628e55904fb9
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master ~]# kubectl get cm my2 <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'.{.data.hosts}'</span>
.127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
192.168.122.200 master
192.168.122.202 node1 
192.168.122.203 node2 
</code></pre></div></div>

<h4 id="使用configmap">使用configmap</h4>

<p>以卷的方式</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span>  <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span>  <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span> 
  <span class="na">creationTimestamp</span><span class="pi">:</span>  <span class="no">null</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">run</span><span class="pi">:</span>  <span class="s">pod3</span>
  <span class="na">name</span><span class="pi">:</span>  <span class="s">pod3</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span>  <span class="s">xx</span>
    <span class="na">configMap</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span>  <span class="s">my2</span>   <span class="c1"># 关联my2的 configmap</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span>  <span class="s">nginx</span>
    <span class="na">imagePullPolicy</span><span class="pi">:</span>  <span class="s">IfNotPresent</span>
    <span class="na">name</span><span class="pi">:</span>  <span class="s">pod3</span>
    <span class="na">resources</span><span class="pi">:</span>  <span class="pi">{}</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span>  <span class="s">xx</span>
      <span class="na">mountPath</span><span class="pi">:</span>  <span class="s2">"</span><span class="s">/etc/test"</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master tmp]# kubectl apply <span class="nt">-f</span> pod.yaml 
pod/pod3 created
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master tmp]# kubectl <span class="nb">exec </span>pod3 <span class="nt">--</span> <span class="nb">ls</span> /etc/test
hosts
issue
</code></pre></div></div>

<p>查看文件</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master tmp]# kubectl <span class="nb">exec </span>pod3 <span class="nt">--</span> <span class="nb">ls</span> /etc/test
hosts
issue
<span class="o">[</span>root@master tmp]# kubectl <span class="nb">exec </span>pod3 <span class="nt">--</span> <span class="nb">cat</span> /etc/test/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
192.168.122.200 master
192.168.122.202 node1 
192.168.122.203 node2 
</code></pre></div></div>

<p>如果只想挂载一个文件则使用subPath</p>

<h4 id="以变量的方式-1">以变量的方式</h4>

<p>创建pod的yaml文件</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span>  <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span>  <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">creationTimestamp</span><span class="pi">:</span>  <span class="no">null</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">run</span><span class="pi">:</span>  <span class="s">pod4</span>
  <span class="na">name</span><span class="pi">:</span>  <span class="s">pod4</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span>  <span class="s">hub.c.163.com/library/mysql:latest</span>
    <span class="na">imagePullPolicy</span><span class="pi">:</span>  <span class="s">IfNotPresent</span>
    <span class="na">name</span><span class="pi">:</span>  <span class="s">pod4</span>
    <span class="na">env</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span>  <span class="s">MYSQL_ROOT_PASSWORD</span>
      <span class="na">valueFrom</span><span class="pi">:</span>
        <span class="na">configMapKeyRef</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span>  <span class="s">my1</span>
          <span class="na">key</span><span class="pi">:</span>  <span class="s">yy</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master tmp]# kubectl apply <span class="nt">-f</span> pod4.yaml 
pod/pod4 created
</code></pre></div></div>

<p>获取IP</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@master tmp]# kubectl get pods <span class="nt">-o</span> wide
NAME   READY   STATUS    RESTARTS   AGE   IP               NODE    NOMINATED NODE   READINESS GATES
pod1   1/1     Running   1          46h   10.244.104.25    node2   &lt;none&gt;           &lt;none&gt;
pod2   1/1     Running   1          46h   10.244.104.24    node2   &lt;none&gt;           &lt;none&gt;
pod3   1/1     Running   0          11m   10.244.166.152   node1   &lt;none&gt;           &lt;none&gt;
pod4   1/1     Running   0          23s   10.244.166.153   node1   &lt;none&gt;           &lt;none&gt;
</code></pre></div></div>

<p>检查</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@node2 ~]# mysql <span class="nt">-uroot</span> <span class="nt">-h10</span>.244.166.153 <span class="nt">-predhat</span>
Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span><span class="nb">.</span>
Your MySQL connection <span class="nb">id </span>is 4
Server version: 5.7.18 MySQL Community Server <span class="o">(</span>GPL<span class="o">)</span>

Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type <span class="s1">'help;'</span> or <span class="s1">'\h'</span> <span class="k">for </span>help. Type <span class="s1">'\c'</span> to clear the current input statement.

MySQL <span class="o">[(</span>none<span class="o">)]&gt;</span> 
</code></pre></div></div>

        
      </section>

      <!-- <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> 标签: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#kubernetes" class="page__taxonomy-item p-category" rel="tag">Kubernetes</a>
    
    </span>
  </p>



 
        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> 更新时间:</strong> <time class="dt-published" datetime="2022-09-27T00:00:00+08:00">September 27, 2022</time></p>
 
      </footer> -->

      <!-- <section class="page__share">
  
    <h4 class="page__share-title">分享</h4>
  

  <a href="https://twitter.com/intent/tweet?text=%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86%20%2Fkubernetes-kubeadm-password%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="分享 Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=%2Fkubernetes-kubeadm-password%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="分享 Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=%2Fkubernetes-kubeadm-password%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="分享 LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>
 -->

      
  <nav class="pagination">
    
      <a href="/docker-04/" class="pagination--pager" title="docker 部署 mysql
">上一页</a>
    
    
      <a href="#" class="pagination--pager disabled">下一页</a>
    
  </nav>

    </div>

     <div class="page__comments">
  
  
      <h4 class="page__comments-title">留下评论</h4>
      <section id="utterances-comments"></section>
    
</div>

  </article>

</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        
        <div class="page__footer-follow">
  多研究些问题，少谈些主义。
 </div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>







    <script>
  'use strict';

  (function() {
    var commentContainer = document.querySelector('#utterances-comments');

    if (!commentContainer) {
      return;
    }

    var script = document.createElement('script');
    script.setAttribute('src', 'https://utteranc.es/client.js');
    script.setAttribute('repo', 'yinyaliang/yinyaliang.github.io');
    script.setAttribute('issue-term', 'pathname');
    script.setAttribute('label', 'comment');
    script.setAttribute('theme', 'github-dark');
    script.setAttribute('crossorigin', 'anonymous');

    commentContainer.appendChild(script);
  })();
</script>

  





  </body>
</html>
